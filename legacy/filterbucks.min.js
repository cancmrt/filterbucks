function filterbucksEngine(e){var t=e.data;filterbucksStartEvent(t,this),"button"==t.type||"a"==t.type?buttonInitSelector(t,this):(jQuery(t.parents).removeClass(t.filterTargetElementClass),jQuery(this).addClass(t.filterTargetElementClass));var r=giveUniqDeepCounts(t),a=allUniqDeepCounts(t);flusher(t,r,this);var s=giveDeepElements(t,r),i=deepQueryCreator(t,s);hasHideUnrelateds(t)&&filterHider(t,s,this,r,a,i);var l=possibleQueryGenerator(t,i);jQuery(t.baseClass).css("display","none"),jQuery(t.baseClass).removeClass(t.filterShowClass),jQuery(t.baseClass).removeClass(t.filterHideClass),jQuery(t.baseClass).addClass(t.filterHideClass),jQuery(l).css("display",""),jQuery(l).removeClass(t.filterHideClass),jQuery(l).addClass(t.filterShowClass),filterbucksEndEvent(t,this)}function filterbucksStartEvent(e,t){jQuery(e.parents).trigger(e.filterStartEvent,t)}function filterbucksEndEvent(e,t){jQuery(e.parents).trigger(e.filterEndEvent,t)}function hasButtonCssOpacity(e){return!(!e.extraConfiguration||!e.extraConfiguration.ButtonCssOpacity||!0!==e.extraConfiguration.ButtonCssOpacity)}function hasHideUnrelateds(e){return!(!e.extraConfiguration||!e.extraConfiguration.HideUnrelateds||!0!==e.extraConfiguration.HideUnrelateds)}function hasBtnSingleChoise(e){return!(!e.extraConfiguration||!e.extraConfiguration.BtnSingleChoise||!0!==e.extraConfiguration.BtnSingleChoise)}function buttonInitSelector(e,t){if(hasBtnSingleChoise(e)){var r=jQuery(t).data(e.dataDeepProp),a=jQuery(e.parents).filter("["+e.buttonCheckSelector+"]").filter("[data-"+e.dataDeepProp+' = "'+r+'"]');1==a.length?(buttonSelectorRemove(e,a),buttonSelectorAdd(e,t)):a.length<1&&buttonSelectorAdd(e,t)}else jQuery(t).is("["+e.buttonCheckSelector+"]")?buttonSelectorRemove(e,t):buttonSelectorAdd(e,t)}function buttonSelectorRemove(e,t){jQuery(t).removeAttr(e.buttonCheckSelector),jQuery(t).removeClass(e.filterTargetElementClass),hasButtonCssOpacity(e)&&jQuery(t).css("opacity","1")}function buttonSelectorAdd(e,t){jQuery(t).attr(e.buttonCheckSelector,""),jQuery(t).addClass(e.filterTargetElementClass),hasButtonCssOpacity(e)&&jQuery(t).css("opacity","0.5")}function giveUniqDeepCounts(e){var t=[];jQuery(e.parents).each(function(r){if("select"==e.type)$(this).find(e.checkSelector).length>0&&t.push(parseInt(jQuery(this).data(e.dataDeepProp),10));else if("radio"==e.type||"checkbox"==e.type||"button"==e.type||"a"==e.type){$(this).filter(e.checkSelector).length>0&&t.push(parseInt(jQuery(this).data(e.dataDeepProp),10))}});var r=t.filter(function(e,t,r){return t===r.indexOf(e)});return r=r.sort(function(e,t){return e-t})}function allUniqDeepCounts(e){var t=[];jQuery(e.parents).each(function(r){"select"==e.type?t.push(parseInt(jQuery(this).data(e.dataDeepProp),10)):"radio"!=e.type&&"checkbox"!=e.type&&"button"!=e.type&&"a"!=e.type||t.push(parseInt(jQuery(this).data(e.dataDeepProp),10))});var r=t.filter(function(e,t,r){return t===r.indexOf(e)});return r=r.sort(function(e,t){return e-t})}function giveDeepElements(e,t){var r=[];return t.forEach(function(t){var a=null;if("select"==e.type)a=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+t+"']").find(e.checkSelector);else if("radio"==e.type||"checkbox"==e.type||"button"==e.type||"a"==e.type)a=jQuery(e.parents).filter(e.checkSelector).filter("[data-"+e.dataDeepProp+"='"+t+"']");jQuery(null!==a&&jQuery(a).length>0),r.push(a)}),r}function flusher(e,t,r){var a=parseInt(jQuery(r).data(e.dataDeepProp),10),s=parseInt(jQuery(r).data(e.dataDeepProp),10);hasFlushProp(e,r)&&a--,t.forEach(function(t){if(a<t){var r=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+t+"']");"select"==e.type?jQuery(r).find("option").each(function(){hasFlushProp(e,this)&&jQuery(r).val($(this).val())}):"button"==e.type||"a"==e.type?jQuery(r).each(function(){hasFlushProp(e,this)&&s!==t&&buttonSelectorAdd(e,this),hasFlushProp(e,this)||buttonSelectorRemove(e,this)}):"radio"!=e.type&&"checkbox"!=e.type||jQuery(r).each(function(){hasFlushProp(e,this)&&s!==t&&jQuery(this).prop("checked",!0),hasFlushProp(e,this)||jQuery(this).prop("checked",!1)})}})}function hasFlushProp(e,t){return!(!jQuery(t).attr("data-"+e.dataFlushProp)||"true"!==jQuery(t).attr("data-"+e.dataFlushProp))}function possibleQueryGenerator(e,t){var r="";return null===t?r=e.baseClass:t.length<=0?r=e.baseClass:null!==t&&t.length>0&&(t.forEach(function(t){r+=e.baseClass+t+","}),r=r.substring(0,r.length-1)),r}function filterHider(e,t,r,a,s,i){var l=parseInt(jQuery(r).data(e.dataDeepProp),10);if(l!=t.length){var n=l+1;if("select"==e.type){var o=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+n+"']");jQuery(o).find("option").each(function(){jQuery(this).removeClass(e.relatedFilterShowClass),jQuery(this).removeClass(e.relatedFilterHideClass),jQuery(this).addClass(e.relatedFilterShowClass),jQuery(this).show()});var u=jQuery(r).find(e.checkSelector);hasFlushProp(e,u)||jQuery(o).find("option").each(function(){if(!hasFlushProp(e,this)){var t=jQuery(this).val(),r=!1;i.forEach(function(a){investgatorClass=e.baseClass+a+"."+t,jQuery(investgatorClass).length>0&&(r=!0)}),r||(jQuery(this).removeClass(e.relatedFilterShowClass),jQuery(this).removeClass(e.relatedFilterHideClass),jQuery(this).addClass(e.relatedFilterHideClass),jQuery(this).hide()),r=!1}})}else if("radio"==e.type||"checkbox"==e.type||"button"==e.type||"a"==e.type){o=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+n+"']");jQuery(o).each(function(){jQuery(this).show()});"radio"!=e.type&&"checkbox"!=e.type||(u=jQuery(r)),"button"!=e.type&&"a"!=e.type||(u=jQuery(e.parents).filter(e.checkSelector).filter("[data-"+e.dataDeepProp+"='"+l+"']")),hasFlushProp(e,u)||jQuery(o).each(function(){if(!hasFlushProp(e,this)){var t=void 0;t="a"===e.type?jQuery(this).attr("value"):jQuery(this).val();var r=!1;i.forEach(function(a){investgatorClass=e.baseClass+a+"."+t,jQuery(investgatorClass).length>0&&(r=!0)}),!r&&i.length>0&&(jQuery(this).removeClass(e.relatedFilterShowClass),jQuery(this).removeClass(e.relatedFilterHideClass),jQuery(this).addClass(e.relatedFilterHideClass),jQuery(this).hide()),r=!1}})}}return t.length<=0&&s.forEach(function(t){if("select"==e.type){var r=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+t+"']");jQuery(r).find("option").each(function(){jQuery(this).removeClass(e.relatedFilterShowClass),jQuery(this).removeClass(e.relatedFilterHideClass),jQuery(this).addClass(e.relatedFilterShowClass),jQuery(this).show()})}else if("radio"==e.type||"checkbox"==e.type||"button"==e.type||"a"==e.type){r=jQuery(e.parents).filter("[data-"+e.dataDeepProp+"='"+t+"']");jQuery(r).each(function(){jQuery(this).removeClass(e.relatedFilterShowClass),jQuery(this).removeClass(e.relatedFilterHideClass),jQuery(this).addClass(e.relatedFilterShowClass),jQuery(this).show()})}}),[]}function deepQueryCreator(e,t,r){if(void 0===r&&(r=null),0===t.length)return r;null===r&&(r=[]);var a=t.slice(),s=a.shift(),i=[],l=jQuery(s).filter("[data-"+e.dataFlushProp+"='true']");return jQuery(l).length<=0?jQuery(s).each(function(e){var t=this;if(0==r.length){var a="."+jQuery(t).attr("value");i.push(a)}else r.length>0&&r.forEach(function(e){var r=e+("."+jQuery(t).attr("value"));i.push(r)})}):jQuery(l).length>0&&(i=r),deepQueryCreator(e,a,i)}jQuery.fn.filterbucks=function(e){var t={parents:this,baseClass:".filterbucks",dataDeepProp:"fbdeep",dataFlushProp:"fbflush",checkSelector:":checked",buttonCheckSelector:"clicked",event:"change",relatedFilterShowClass:"filterbucksRelatedShow",relatedFilterHideClass:"filterbucksRelatedHide",filterShowClass:"filterbucksFilteredShow",filterHideClass:"filterbucksFilteredHide",filterTargetElementClass:"filterbucksSelected",filterStartEvent:"filterbucks-start",filterEndEvent:"filterbucks-end",type:"INPUT"==jQuery(this)[0].tagName?jQuery(this)[0].type.toLowerCase():jQuery(this)[0].tagName.toLowerCase(),extraConfiguration:e};this.filterbucksRunner(t)},jQuery.fn.filterbucksRunner=function(e){"button"!==e.type&&"a"!==e.type||(e.event="click",e.checkSelector="[clicked]"),"select"===e.type&&(e.checkSelector="option:selected"),"radio"!==e.type&&"checkbox"!==e.type||(e.checkSelector=":checked"),console.log(e),this.on(e.event,e,filterbucksEngine)};